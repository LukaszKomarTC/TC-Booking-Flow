      - name: Probe SFTP root (no shell)
        env:
          SFTP_HOST_RAW: ${{ secrets.FTP_SERVER }}
          SFTP_USER_RAW: ${{ secrets.FTP_USERNAME }}
          SFTP_PASS: ${{ secrets.FTP_PASSWORD }}
        run: |
          set -e
          sudo apt-get update
          sudo apt-get install -y sshpass

          SFTP_HOST="$(printf "%s" "$SFTP_HOST_RAW" | tr -d '\r' | xargs)"
          SFTP_USER="$(printf "%s" "$SFTP_USER_RAW" | tr -d '\r' | xargs)"

          cat > sftp-probe.txt <<'EOF'
          pwd
          ls
          ls staging
          bye
          EOF

          sshpass -p "$SFTP_PASS" sftp \
            -oBatchMode=no \
            -oStrictHostKeyChecking=no \
            -oUserKnownHostsFile=/dev/null \
            -P 22 \
            -b sftp-probe.txt \
            "$SFTP_USER@$SFTP_HOST"

      - name: Upload via SFTP (no shell)
        env:
          SFTP_HOST_RAW: ${{ secrets.FTP_SERVER }}
          SFTP_USER_RAW: ${{ secrets.FTP_USERNAME }}
          SFTP_PASS: ${{ secrets.FTP_PASSWORD }}
          REMOTE_DIR_RAW: ${{ secrets.FTP_REMOTE_DIR }}
        run: |
          set -e
          sudo apt-get update
          sudo apt-get install -y sshpass

          SFTP_HOST="$(printf "%s" "$SFTP_HOST_RAW" | tr -d '\r' | xargs)"
          SFTP_USER="$(printf "%s" "$SFTP_USER_RAW" | tr -d '\r' | xargs)"
          REMOTE_DIR="$(printf "%s" "$REMOTE_DIR_RAW" | tr -d '\r' | xargs)"

          cat > sftp-batch.txt <<EOF
          mkdir $REMOTE_DIR
          cd $REMOTE_DIR
          put latest.zip
          put latest.json
          bye
          EOF

          sshpass -p "$SFTP_PASS" sftp \
            -oBatchMode=no \
            -oStrictHostKeyChecking=no \
            -oUserKnownHostsFile=/dev/null \
            -P 22 \
            -b sftp-batch.txt \
            "$SFTP_USER@$SFTP_HOST"
